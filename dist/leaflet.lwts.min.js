L.Control.SliderControl=L.Control.extend({options:{position:"topright",layers:null,startTime:moment(0),endTime:moment(0),timeStep:3600,timeStops:[],range:!1,dateDisplayFormat:"YYYY-MM-DDTHH:mm:ssZ",timezone:"UTC"},initialize:function(a){if(L.Util.setOptions(this,a),this._layer=null,this.multilayer=!1,this._begin_time=a.startTime.tz(this.options.timezone),this._final_time=a.endTime.tz(this.options.timezone),this.options.timeStep=1e3*a.timeStep,a.timeStops&&0!=a.timeStops.length)this.options.timeStops=a.timeStops,this.options.timeSteps=a.timeStops.length;else{this.options.timeStops=[],this.options.timeSteps=Math.ceil((this._final_time-this._begin_time)/this.options.timeStep);for(var b=0;b<=this.options.timeSteps;b++)this.options.timeStops.push(moment(this._begin_time).add(b*this.options.timeStep,"ms").tz(this.options.timezone))}null==this.options.layers?(this._layer=this.options.layer,this.multilayer=!1):(this._layer=this.options.layers,this.multilayer=!0)},setPosition:function(a){var b=this._map;return b&&b.removeControl(this),this.options.position=a,b&&b.addControl(this),this.startSlider(),this},createSliderUI:function(){var a=L.DomUtil.create("div","ui-slider-container",this._container);return this._slider=$('<div class="ui-slider"><div class="ui-slider-handle"></div></div>'),$(a).append(this._slider),this._sliderTimestamp=$('<div class="ui-slider-timestamp"></div>'),$(a).append(this._sliderTimestamp),a},onAdd:function(a){this.options.map=a;var b=this.createSliderUI();return $(b).mousedown(function(){a.dragging.disable()}),$(document).mouseup(function(){a.dragging.enable()}),this._layer||console.log("Error: You must specify a layer via new SliderControl({layer: your_layer}); or like SliderControl({layers: [your_layer1, your_layer2]});"),b},onRemove:function(a){a.removeLayer(this._layer),$(this._slider).remove()},updateLayer:function(a){var b=moment.utc(a[0]).format();if(a.length>1&&(b+="/"+moment.utc(a[1]).format()),1==this.multilayer)for(var c=0;c<this._layer.length;c++)this._layer[c].setParams({time:b});else this._layer.setParams({time:b})},updateTimestamp:function(a){1===a.length?$(this._sliderTimestamp).html(a[0].format(this.options.dateDisplayFormat)):$(this._sliderTimestamp).html(a[0].format(this.options.dateDisplayFormat)+" - "+a[1].format(this.options.dateDisplayFormat))},buildTimestamp:function(a,b){var c=[];return c.push(this.options.timeStops[a]),b&&c.push(this.options.timeStops[b]),console.dir(this.options.timeStops[a].format()),c},startSlider:function(){var a=this;$(a._slider).slider({range:a.options.range,min:0,max:a.options.timeSteps,step:1,slide:function(b,c){a.options.range?a.updateTimestamp(a.buildTimestamp(c.values[0],c.values[1])):a.updateTimestamp(a.buildTimestamp(c.value))},stop:function(b,c){a.options.range?a.updateLayer(a.buildTimestamp(c.values[0],c.values[1])):a.updateLayer(a.buildTimestamp(c.value))}}),a.options.range?(a.updateTimestamp(a.buildTimestamp(0,1)),a.updateLayer(a.buildTimestamp(0,1))):(a.updateTimestamp(a.buildTimestamp(0)),a.updateLayer(a.buildTimestamp(0)))}}),L.control.sliderControl=function(a){return new L.Control.SliderControl(a)};